---
title: "puert-2-rico"
author: "Jessica French"
date: "2022-08-24"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(lubridate)
library(janitor)
<<<<<<< HEAD
library(patchwork)
library(ggpubr)

=======
library(paletteer)
>>>>>>> 9b17dd8fdf60f9fd187615f6f6c0ef4f4a5b7155
```

## Read in data files in csv format 
```{r}
bq1 <- read_csv(file.path("","courses", "EDS214", "puert-2-rico", "raw_data", "QuebradaCuenca1-Bisley.csv"))
bq2 <- read_csv(file.path("","courses", "EDS214", "puert-2-rico", "raw_data", "QuebradaCuenca2-Bisley.csv"))
bq3 <- read_csv(file.path("","courses", "EDS214", "puert-2-rico", "raw_data", "QuebradaCuenca3-Bisley.csv"))
prm <- read_csv(file.path("","courses", "EDS214", "puert-2-rico", "raw_data", "RioMameyesPuenteRoto.csv"))
```


```{r}
# Select Columns that include sample id, sample date, nitrogen, and potassium concentration. 
columns_vector <- c("Sample_ID", "Sample_Date", "NO3-N", "K") #vector of columns to be kept. 


#select columns form columns vector, create columns for month and year and filter to rows that contain years 1988 to 1994. 
bq1_tidy <- bq1 |> 
  select(columns_vector) |> #---- subset to include only the columns (variables) we want
  mutate(Year = year(Sample_Date), Month = month(Sample_Date)) |>   #---- add a new column with year - month combination
  filter(Year %in% c(seq(from = 1988, to = 1994))). #---- subset only for rows in the time frame of interest

bq2_tidy <- bq2 |>   #---- complete the exact same steps for the following three data sets 
  select(columns_vector) |>      
  mutate(Year = year(Sample_Date), Month = month(Sample_Date)) |> 
  filter(Year %in% c(seq(from = 1988, to = 1994)))

bq3_tidy <- bq3 |> 
  select(columns_vector) |> 
  mutate(Year = year(Sample_Date), Month = month(Sample_Date)) |> 
  filter(Year %in% c(seq(from = 1988, to = 1994)))

prm_tidy <- prm |> 
  select(columns_vector) |> 
  mutate(Year = year(Sample_Date), Month = month(Sample_Date)) |> 
  filter(Year %in% c(seq(from = 1988, to = 1994)))

#Combine four data sets into one data frame. 
combined_data <- bind_rows(bq1_tidy, bq2_tidy, bq3_tidy, prm_tidy)

```

```{r}
#Create one column of month and year in date format so that nitrogen concentration can be summarized by month and year.

combined_data_mean <- combined_data |> 
  mutate(Month_Year = paste(month(Sample_Date), year(Sample_Date))) |> 
  mutate(Month_Year = my(Month_Year)) |> 
  group_by(Month_Year, Sample_ID) |> 
  summarize(Monthly_Mean_N = mean(`NO3-N`, na.rm = TRUE), 
            Monthly_Mean_K = mean(K, na.rm = TRUE))

```


```{r}
# Plot of mean monthly nitrogen concentration from 1988 to 1994. 
plot_1989_1994_N <- ggplot(data = combined_data_mean, aes(x = Month_Year,
                                                   y = Monthly_Mean_N)) +
  geom_line(aes(linetype = Sample_ID, color = Sample_ID)) +
  labs(x = "Year",
       y = ("Mean NO3-N")) +
  guides(color = guide_legend(title = "Sample Site"))


plot_1989_1994_N
```


```{r}
# Plot of mean monthly potassium concentration from 1988 to 1994. 
plot_1989_1994_K <- ggplot(data = combined_data_mean, aes(x = Month_Year,
                                                   y = Monthly_Mean_K)) +
  geom_line(aes(linetype = Sample_ID, color = Sample_ID)) +
  labs(x = "Year",
       y = "Mean K") +
  guides(color = guide_legend(title = "Sample Site"))


plot_1989_1994_K
```

```{r}

# Combine potassium and nitrogen graphs. 

bq1_clean <- bq1 %>% select(Sample_ID, Sample_Date, K, `NO3-N`) %>% 
  mutate(Year = lubridate::year(Sample_Date)) %>% 
  filter(Year %in% c(2011,2012,2013,2014,2015,2016,2017,2018))

bq2_clean <- bq2 %>% select(Sample_ID, Sample_Date, K, `NO3-N`) %>% 
  mutate(Year = lubridate::year(Sample_Date)) %>% 
  filter(Year %in% c(2011,2012,2013,2014,2015,2016,2017,2018))

bq3_clean <- bq3 %>% select(Sample_ID, Sample_Date, K, `NO3-N`) %>% 
  mutate(Year = lubridate::year(Sample_Date)) %>% 
  filter(Year %in% c(2011,2012,2013,2014,2015,2016,2017,2018))

prm_clean <- prm %>% select(Sample_ID, Sample_Date, K, `NO3-N`) %>% 
  mutate(Year = lubridate::year(Sample_Date)) %>% 
  filter(Year %in% c(2011,2012,2013,2014,2015,2016,2017,2018))
```

```{r}
q2_allsites_K <- bind_rows(bq1_clean, bq2_clean, bq3_clean, prm_clean) %>% 
  mutate(Month_Year = paste(lubridate::month(Sample_Date),lubridate::year(Sample_Date))) %>% 
  mutate(Month_Year = lubridate:: my(Month_Year)) %>% 
  group_by(Month_Year, Sample_ID) %>% summarise(mean = mean(K))

ggplot(q2_allsites_K, aes(x = Month_Year , y = mean)) + geom_line(aes(color = Sample_ID)) + scale_color_paletteer_d("fishualize::Koumansetta_rainfordi") + 
  labs(x = "Year",
       y = "Mean Potassium Concentration") +
  guides(color = guide_legend(title = "Sample Site"))
```

```{r}
q1_allsites_NO3 <- bind_rows(bq1_clean, bq2_clean, bq3_clean, prm_clean) %>% 
  mutate(Month_Year = paste(lubridate::month(Sample_Date),lubridate::year(Sample_Date))) %>% 
  mutate(Month_Year = lubridate:: my(Month_Year)) %>% 
  group_by(Month_Year, Sample_ID) %>% summarise(mean = mean(`NO3-N`))

ggplot(q1_allsites_NO3, aes(x = Month_Year , y = mean)) + geom_line(aes(color = Sample_ID)) + scale_color_paletteer_d("fishualize::Koumansetta_rainfordi")  + 
  labs(x = "Year",
       y = "Mean Nitrate Concentration") +
  guides(color = guide_legend(title = "Sample Site"))
```


combined_graph
```

```{r}
ggarrange( 
          plot_1989_1994_K + 
               theme(axis.text.x = element_blank(),
                     axis.ticks.x = element_blank(),
                     axis.title.x = element_blank() ), 
          plot_1989_1994_N,
          
          nrow = 2,
          ncol = 1)
```

