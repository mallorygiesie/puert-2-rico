---
title: "puert-2-rico"
author: "Jessica French"
date: "2022-08-24"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(lubridate)
library(janitor)
```

## Read in data files in csv format 
```{r}
bq1 <- read_csv(file.path("","courses", "EDS214", "puert-2-rico", "raw_data", "QuebradaCuenca1-Bisley.csv"))
bq2 <- read_csv(file.path("","courses", "EDS214", "puert-2-rico", "raw_data", "QuebradaCuenca2-Bisley.csv"))
bq3 <- read_csv(file.path("","courses", "EDS214", "puert-2-rico", "raw_data", "QuebradaCuenca3-Bisley.csv"))
prm <- read_csv(file.path("","courses", "EDS214", "puert-2-rico", "raw_data", "RioMameyesPuenteRoto.csv"))
```


```{r}
# Select Columns that include sample id, sample date, nitrogen, and potassium concentration. 
columns_vector <- c("Sample_ID", "Sample_Date", "NO3-N", "K") #vector of columns to be kept. 


#select columns form columns vector, create columns for month and year adn filter to rows that contain years 1988 to 1994. 
bq1_tidy <- bq1 |> 
  select(columns_vector) |>           #creating a subset of only columns that we are interested in (from vector above)
  mutate(Year = year(Sample_Date), Month = month(Sample_Date)) |>  #adding month and year columns (lubridate)
  filter(Year %in% c(seq(from = 1988, to = 1994)))        #subsetting for only rows in the time frame of interest

bq2_tidy <- bq2 |>                        #repeating this sequence for the other three watershed dataframes
  select(columns_vector) |> 
  mutate(Year = year(Sample_Date), Month = month(Sample_Date)) |> 
  filter(Year %in% c(seq(from = 1988, to = 1994)))

bq3_tidy <- bq3 |> 
  select(columns_vector) |> 
  mutate(Year = year(Sample_Date), Month = month(Sample_Date)) |> 
  filter(Year %in% c(seq(from = 1988, to = 1994)))

prm_tidy <- prm |> 
  select(columns_vector) |> 
  mutate(Year = year(Sample_Date), Month = month(Sample_Date)) |> 
  filter(Year %in% c(seq(from = 1988, to = 1994)))

#Combine four data sets into one data frame. 
combined_data <- bind_rows(bq1_tidy, bq2_tidy, bq3_tidy, prm_tidy)   #binding the rows together to make a combined data                                                                        frame using bind_rows()

```

```{r}
#Create one column of month and year in date format so that nitrogen concentration can be summarized by month and year.
combined_data_mean_N <- combined_data |>   #creating a new column with unique year-month combinations
  mutate(Month_Year = paste(month(Sample_Date), year(Sample_Date))) |>  #pasting year and month together (class:character)
  mutate(Month_Year = my(Month_Year)) |>   #using lubridate again to go back to date format in new column
  group_by(Month_Year, Sample_ID) |>       #group_by() into summarize() to get monthlly averages (to graph later)
  summarize(Monthly_Mean = mean(`NO3-N`, na.rm = TRUE))   #avoiding gaps by removing NA values 

#Monthly mean for postassium. (same workflow as above)
combined_data_mean_K <- combined_data |>    
  mutate(Month_Year = paste(month(Sample_Date), year(Sample_Date))) |> 
  mutate(Month_Year = my(Month_Year)) |> 
  group_by(Month_Year, Sample_ID) |> 
  summarize(Monthly_Mean = mean(K, na.rm = TRUE))
```


```{r}
# Plot of mean monthly nitrogen concentration from 1988 to 1994. 
plot_1989_1994_N <- ggplot(data = combined_data_mean_N, aes(x = Month_Year,
                                                   y = Monthly_Mean)) +
  geom_line(aes(linetype = Sample_ID, color = Sample_ID)) +
  labs(x = "Year",
       y = "Mean Nitrogen Concentration")

plot_1989_1994_N
```


```{r}
# Plot of mean monthly potassium concentration from 1988 to 1994. 
plot_1989_1994_K <- ggplot(data = combined_data_mean_K, aes(x = Month_Year,
                                                   y = Monthly_Mean)) +
  geom_line(aes(linetype = Sample_ID, color = Sample_ID)) +
  labs(x = "Year",
       y = "Mean Potassium Concentration")

plot_1989_1994_K
```

```{r}
bq1_clean <- bq1 %>% select(Sample_ID, Sample_Date, K, `NO3-N`) %>% 
  mutate(Year = lubridate::year(Sample_Date)) %>% 
  filter(Year %in% c(2011,2012,2013,2014,2015,2016,2017,2018))

bq2_clean <- bq2 %>% select(Sample_ID, Sample_Date, K, `NO3-N`) %>% 
  mutate(Year = lubridate::year(Sample_Date)) %>% 
  filter(Year %in% c(2011,2012,2013,2014,2015,2016,2017,2018))

bq3_clean <- bq3 %>% select(Sample_ID, Sample_Date, K, `NO3-N`) %>% 
  mutate(Year = lubridate::year(Sample_Date)) %>% 
  filter(Year %in% c(2011,2012,2013,2014,2015,2016,2017,2018))

prm_clean <- prm %>% select(Sample_ID, Sample_Date, K, `NO3-N`) %>% 
  mutate(Year = lubridate::year(Sample_Date)) %>% 
  filter(Year %in% c(2011,2012,2013,2014,2015,2016,2017,2018))
```

```{r}
q2_allsites_K <- bind_rows(bq1_clean, bq2_clean, bq3_clean, prm_clean) %>% 
  mutate(Month_Year = paste(lubridate::month(Sample_Date),lubridate::year(Sample_Date))) %>% 
  mutate(Month_Year = lubridate:: my(Month_Year)) %>% 
  group_by(Month_Year, Sample_ID) %>% summarise(mean = mean(K))

ggplot(q2_allsites_K, aes(x = Month_Year , y = mean)) + geom_line(aes(color = Sample_ID))
```

```{r}
q1_allsites_NO3 <- bind_rows(bq1_clean, bq2_clean, bq3_clean, prm_clean) %>% 
  mutate(Month_Year = paste(lubridate::month(Sample_Date),lubridate::year(Sample_Date))) %>% 
  mutate(Month_Year = lubridate:: my(Month_Year)) %>% 
  group_by(Month_Year, Sample_ID) %>% summarise(mean = mean(`NO3-N`))

ggplot(q1_allsites_NO3, aes(x = Month_Year , y = mean)) + geom_line(aes(color = Sample_ID))
```


