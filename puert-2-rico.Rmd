---
title: "puert-2-rico"
author: "Jessica French"
date: "2022-08-24"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(lubridate)
library(janitor)
library(patchwork)
library(ggpubr)

```

## Read in data files in csv format 
```{r}
bq1 <- read_csv(file.path("","courses", "EDS214", "puert-2-rico", "raw_data", "QuebradaCuenca1-Bisley.csv"))
bq2 <- read_csv(file.path("","courses", "EDS214", "puert-2-rico", "raw_data", "QuebradaCuenca2-Bisley.csv"))
bq3 <- read_csv(file.path("","courses", "EDS214", "puert-2-rico", "raw_data", "QuebradaCuenca3-Bisley.csv"))
prm <- read_csv(file.path("","courses", "EDS214", "puert-2-rico", "raw_data", "RioMameyesPuenteRoto.csv"))
```


```{r}
# Select Columns that include sample id, sample date, nitrogen, and potassium concentration. 
columns_vector <- c("Sample_ID", "Sample_Date", "NO3-N", "K") #vector of columns to be kept. 


#select columns form columns vector, create columns for month and year adn filter to rows that contain years 1988 to 1994. 
bq1_tidy <- bq1 |> 
  select(columns_vector) |> 
  mutate(Year = year(Sample_Date), Month = month(Sample_Date)) |> 
  filter(Year %in% c(seq(from = 1988, to = 1994)))

bq2_tidy <- bq2 |> 
  select(columns_vector) |> 
  mutate(Year = year(Sample_Date), Month = month(Sample_Date)) |> 
  filter(Year %in% c(seq(from = 1988, to = 1994)))

bq3_tidy <- bq3 |> 
  select(columns_vector) |> 
  mutate(Year = year(Sample_Date), Month = month(Sample_Date)) |> 
  filter(Year %in% c(seq(from = 1988, to = 1994)))

prm_tidy <- prm |> 
  select(columns_vector) |> 
  mutate(Year = year(Sample_Date), Month = month(Sample_Date)) |> 
  filter(Year %in% c(seq(from = 1988, to = 1994)))

#Combine four data sets into one data frame. 
combined_data <- bind_rows(bq1_tidy, bq2_tidy, bq3_tidy, prm_tidy)

```

```{r}
#Create one column of month and year in date format so that nitrogen concentration can be summarized by month and year.
combined_data_mean <- combined_data |> 
  mutate(Month_Year = paste(month(Sample_Date), year(Sample_Date))) |> 
  mutate(Month_Year = my(Month_Year)) |> 
  group_by(Month_Year, Sample_ID) |> 
  summarize(Monthly_Mean_N = mean(`NO3-N`, na.rm = TRUE), 
            Monthly_Mean_K = mean(K, na.rm = TRUE))

#Monthly mean for postassium. 
combined_data_mean_K <- combined_data |> 
  mutate(Month_Year = paste(month(Sample_Date), year(Sample_Date))) |> 
  mutate(Month_Year = my(Month_Year)) |> 
  group_by(Month_Year, Sample_ID) |> 
  summarize(Monthly_Mean = mean(K, na.rm = TRUE))
```


```{r}
# Plot of mean monthly nitrogen concentration from 1988 to 1994. 
plot_1989_1994_N <- ggplot(data = combined_data_mean, aes(x = Month_Year,
                                                   y = Monthly_Mean_N)) +
  geom_line(aes(linetype = Sample_ID, color = Sample_ID)) +
  labs(x = "Year",
       y = ("Mean NO3-N"))

plot_1989_1994_N
```


```{r}
# Plot of mean monthly potassium concentration from 1988 to 1994. 
plot_1989_1994_K <- ggplot(data = combined_data_mean, aes(x = Month_Year,
                                                   y = Monthly_Mean_K)) +
  geom_line(aes(linetype = Sample_ID, color = Sample_ID)) +
  labs(x = "Year",
       y = expression("Mean K"))

plot_1989_1994_K
```

```{r}
# Combine potassium and nitrogen graphs. 

combined_graph <- plot_1989_1994_N / plot_1989_1994_K

combined_graph
```

```{r}
ggarrange( 
          plot_1989_1994_K + 
               theme(axis.text.x = element_blank(),
                     axis.ticks.x = element_blank(),
                     axis.title.x = element_blank() ), 
          plot_1989_1994_N,
          
          nrow = 2,
          ncol = 1)
```

